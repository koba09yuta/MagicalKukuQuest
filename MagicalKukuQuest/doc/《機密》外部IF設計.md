<div style="text-align:right">
  <strong style="color:red;">CONFIDENTIAL ベネッセコーポレーション</strong>
  <hr style="background-color:#3f50b5;">
</div>

<p><b><font size="7">サンプルアプリ　外部IF設計</font></b></p>

<!-- TOC -->

- [1. 外部IF一覧](#1-外部if一覧)
- [2. SSO認証API](#2-sso認証api)
    - [2.1. 入力](#21-入力)
        - [2.1.1. パラメータ](#211-パラメータ)
    - [2.2. 出力](#22-出力)
        - [2.2.1. パラメーター](#221-パラメーター)
    - [2.3. 処理結果ステータス](#23-処理結果ステータス)
- [3. TOP画面要素取得サービス](#3-top画面要素取得サービス)
    - [3.1. 入力](#31-入力)
        - [3.1.1. サンプル](#311-サンプル)
    - [3.2. 出力](#32-出力)
        - [3.2.1. サンプル](#321-サンプル)
    - [3.3. 処理結果ステータス](#33-処理結果ステータス)

<!-- /TOC -->

# 1. 外部IF一覧

本アプリで使用する外部IFの一覧を以下に示す。

| API(サービス)名         | 接続先名     | 機能概要                                                                       |
| :---------------------- | :----------- | :----------------------------------------------------------------------------- |
| SSO認証API              | 統合認証基盤 | HTTPリクエストで認証情報を送付し、正しい情報であればセッションキーが発行される |
| TOP画像要素取得サービス | 画像投稿基盤 | ガゾーンのTOP画面で必要な静的情報を取得するサービス                            |

# 2. SSO認証API

| 接続先       | プロトコル | メソッド | 接続URL                                  |
| :----------- | :--------- | :------- | :--------------------------------------- |
| 統合認証基盤 | HTTPS      | POST     | `https://login.benesse.ne.jp/appsso/sso` |

## 2.1. 入力

- 格納先 : HTTPリクエストボディ
- Content-Type : application/x-www-form-urlencoded

### 2.1.1. パラメータ

| パラメータ名 | 論理名                          | 必須 | サイズ    | 型     | 補足                                                                                                                         |
| :----------- | :------------------------------ | :--- | :-------- | :----- | :--------------------------------------------------------------------------------------------------------------------------- |
| onetimeid    | SSO認証用一時キー               | ○    | 1~32byte  | string | 半角英数字<br>ブラウザアプリへのSSO一時キー発行APIで取得した一時キーを設定する                                               |
| app_id       | アプリ識別子                    | ○    | 1~128byte | string | ASCIIコードの<br>0x21~0x7Eの値<br>Dcha共通のアプリ識別子を設定する                                                           |
| next         | Cookie発行先のリダイレクト先URL | ○    | 1~128byte | string | ASCIIコードの<br>0x21~0x7Eの値<br>本アプリではリダイレクトは行わないので、"https://benesse.ne.jp"で始まる任意のURLを設定する |

## 2.2. 出力

- 格納先 : Cookie情報
- CookieName : fnssso_https_key

### 2.2.1. パラメーター

| パラメーター名 | 値                                                       |
| :------------- | :------------------------------------------------------- |
| name           | アプリごとに設定されているhttps用セッションCookie名称    |
| value          | 「ユーザID：セッションID」をBase64エンコードした値       |
| domain         | アプリごとに設定されているCookie送信ドメイン名           |
| expires        | アプリごとに設定されているCookieの有効期限から算出した値 |
| secure         | 値なし（属性のみ付与）                                   |

## 2.3. 処理結果ステータス

- HTTPのステータスコードにて結果を返却
- 正常に認証が行われた場合は302が返却される

# 3. TOP画面要素取得サービス

| 接続先       | プロトコル | メソッド | 接続URL                                              |
| :----------- | :--------- | :------- | :--------------------------------------------------- |
| 画像投稿基盤 | HTTPS      | POST     | `https://sgaku.benesse.ne.jp/imagepostui/uiservice/` |

## 3.1. 入力

- 格納先 : リクエストボディ
- Content-Type : application/json

| JSON key | 論理名 | 必須 | サイズ       | 型     | 補足                                                                                           |
| :------- | :----- | :--- | :----------- | :----- | :--------------------------------------------------------------------------------------------- |
| ThmId    | 企画ID | ○    | 1文字~20文字 | string | 半角英数字(a-z,A-Z,0-9)、半角アンダースコア(_)のみ<br>設定ファイルから取得した企画IDを設定する |

### 3.1.1. サンプル

```Json
{"ThmSelect":[{"ThmId":"20180831_o"}]}
```

## 3.2. 出力

- 格納先 : レスポンスボディ
- Content-Type : application/json

| JSON key       | 論理名             | 必須 | サイズ | 型     | 補足                          |
| :------------- | :----------------- | :--- | :----- | :----- | :---------------------------- |
| Tittle         | タイトル           | ○    |        | 文字列 |                               |
| NewsTxt        | お知らせ内容       | ○    |        | 文字列 |                               |
| NewsImgUrl     | お知らせ画像URL    | ○    |        | 文字列 |                               |
| PcUpImgId      | ピックアップ画像ID | ○    |        | 数値   |                               |
| DspFlg         | 非表示フラグ       | ○    |        | 数値   |                               |
| SysDh          | サーバー日時       | ○    |        | 日付   | 日付形式：YYYY/MM/DD HH:mm:ss |
| BackUrl        | 戻り先URL          |      |        | 文字列 |                               |
| CloseTxt       | 非表示時文言       |      |        | 文字列 |                               |
| TodayPostCount | 本日の残り投稿数   | ○    |        | 数値   |                               |
| PostCount      | 残り投稿数         | ○    |        | 数値   |                               |
| MaxPostCount   | 投稿数上限値       | ○    |        | 数値   |                               |
| ScyrType       | 学年タイプ         | ○    |        | 数値   |                               |
| IcnImgCnt      | アイコン数         | ○    |        | 数値   |                               |
| BgImgCnt       | 背景数             | ○    |        | 数値   |                               |

### 3.2.1. サンプル

```Json
ThmSelect: [{
  BackUrl: null
  BgImgCnt: 4
  CloseTxt: "おわったよ応用"
  DspFlg: 1
  IcnImgCnt: 4
  MaxPostCount: 100
  NewsImgUrl: null
  NewsTxt: ""
  PcUpImgId: null
  PostCount: 3
  ScyrType: 0
  SysDh: "2019/03/19 17:46:50"
  Tittle: "応用のテスト"
  TodayPostCount: 5
}]
```

## 3.3. 処理結果ステータス

- HTTPのステータスコードにて結果を返却

<div style="text-align:right">
  <hr style="background-color:#3f50b5;">
</div>